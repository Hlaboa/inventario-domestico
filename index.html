<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Gestor de almac√©n de cocina</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="data:," />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app">


      <main class="app-main shopping-hidden">
        <!-- Panel principal -->
        <section class="panel">
          <!-- Tabs principal -->
          <div class="tabs tabs-main">
            <button
              type="button"
              id="mainAlmacenButton"
              class="tab-button active"
            >
              Almac√©n
            </button>
            <button type="button" id="mainOtrosButton" class="tab-button">
              Otros productos
            </button>
            <button type="button" id="mainSelectionButton" class="tab-button">
              Selecci√≥n de productos
            </button>
            <button type="button" id="mainClassificationButton" class="tab-button">
              Clasificaci√≥n productos
            </button>
            <button type="button" id="mainProducersButton" class="tab-button">
              Productores
            </button>
            <button type="button" id="mainStoresButton" class="tab-button">
              Tiendas
            </button>
            <button
              type="button"
              id="toggleShoppingPanelButton"
              class="tab-button tab-button-icon"
              aria-label="Mostrar u ocultar lista de la compra"
              title="Mostrar u ocultar lista de la compra"
            >
              üõí
            </button>
          </div>

          <!-- ============================
               SECCI√ìN ALMAC√âN
               ============================ -->
          <section id="almacenSection" class="main-section active">
            <div class="section-mode-header">
              <div>
                <h2>Inventario de almac√©n</h2>
                <p class="panel-subtitle">
                  Marca qu√© tienes, qu√© falta y define una Selecci√≥n prioritaria.
                </p>
              </div>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="almacenEditModeButton"
              >
                Editar inventario
              </button>
            </div>

            <!-- Vista principal -->
            <div id="almacenInventoryPanel" class="sub-panel active">
              <div class="filters">
                <div class="form-group quick-add-group">
                  <label>&nbsp;</label>
                  <button
                    type="button"
                    class="btn btn-secondary btn-small btn-quick-add"
                    id="addQuickProductButton"
                  >
                    +
                  </button>
                </div>
                <div class="form-group search-group">
                  <label for="filterSearch">Buscar</label>
                  <input
                    type="text"
                    id="filterSearch"
                    placeholder="Producto, familia, selecci√≥n, notas..."
                  />
                </div>
                <div class="form-group">
                  <label for="filterBlock">Familia</label>
                  <select id="filterBlock">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filterType">Tipo</label>
                  <select id="filterType">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filterShelf">Ubicaci√≥n</label>
                  <select id="filterShelf">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filterStore">Tienda</label>
                  <select id="filterStore">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filterStatus">Estado</label>
                  <select id="filterStatus">
                    <option value="all">Todos</option>
                    <option value="have">Tengo</option>
                    <option value="missing">Me falta</option>
                  </select>
                </div>
              </div>

              <div class="list-header">
                <div class="summary" id="summaryInfo">
                  Total: 0 ¬∑ Tengo: 0 ¬∑ Faltan: 0
                </div>
              </div>

              <div class="table-wrapper" id="instancesTableWrapper">
                <div class="table-scroll">
                  <table class="product-table">
                    <thead>
                      <tr>
                        <th>Producto</th>
                        <th>Familia</th>
                        <th>Tipo</th>
                        <th>Ubicaci√≥n</th>
                        <th>Cantidad</th>
                        <th class="selection-col">Selecci√≥n</th>
                        <th>Tiendas</th>
                        <th>Tengo</th>
                        <th>F. adquisici√≥n</th>
                        <th>Caducidad</th>
                        <th>Notas</th>
                        <th>Retirar</th>
                      </tr>
                    </thead>
                    <tbody id="productTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Modo edici√≥n -->
            <div id="almacenEditPanel" class="sub-panel">
              <div class="grid-header">
                <div>
                  <h2>Editar inventario</h2>
                  <p class="panel-subtitle">
                    A√±ade, modifica y organiza los productos de tu almac√©n.
                  </p>
                </div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addGridRowButton"
                  >
                    A√±adir producto
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveGridButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>

              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="editFilterSearch">Buscar en edici√≥n</label>
                  <input
                    type="text"
                    id="editFilterSearch"
                    placeholder="Producto, notas, selecci√≥n..."
                  />
                </div>
                <div class="form-group">
                  <label for="editFilterFamily">Familia</label>
                  <select id="editFilterFamily">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="editFilterType">Tipo</label>
                  <select id="editFilterType">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="editFilterShelf">Ubicaci√≥n</label>
                  <select id="editFilterShelf">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="editFilterStore">Tienda</label>
                  <select id="editFilterStore">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <table class="product-table">
                    <thead>
                      <tr>
                        <th>Producto</th>
                        <th>Familia</th>
                        <th>Tipo</th>
                        <th>Ubicaci√≥n</th>
                        <th>Cantidad</th>
                        <th class="selection-col">Selecci√≥n</th>
                        <th>Tiendas</th>
                        <th>Tengo</th>
                        <th>F. adquisici√≥n</th>
                        <th>Caducidad</th>
                        <th>Notas</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="gridTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>

          <!-- ============================
               SECCI√ìN CLASIFICACI√ìN
               ============================ -->
          <section id="classificationSection" class="main-section">
            <div class="section-mode-header">
              <div>
                <h2>Clasificaci√≥n de productos</h2>
                <p class="panel-subtitle">
                  Gestiona las combinaciones de Familia y Tipo que se usan en todo el inventario.
                </p>
              </div>
              <div class="extra-header-actions">
                <button
                  type="button"
                  class="btn btn-secondary btn-small"
                  id="addClassificationButton"
                >
                  A√±adir combinaci√≥n
                </button>
                <button
                  type="button"
                  class="btn btn-primary btn-small"
                  id="saveClassificationsButton"
                >
                  Guardar cambios
                </button>
              </div>
            </div>

            <div class="table-wrapper">
              <div class="table-scroll">
                <table class="product-table">
                  <thead>
                    <tr>
                      <th>Familia</th>
                      <th>Tipo</th>
                      <th>Notas</th>
                      <th>Eliminar</th>
                    </tr>
                  </thead>
                  <tbody id="classificationTableBody"></tbody>
                </table>
              </div>
            </div>
          </section>

          <!-- ============================
               SECCI√ìN OTROS PRODUCTOS
               ============================ -->
          <section id="otrosSection" class="main-section">
            <div class="section-mode-header">
              <div>
                <h2>Otros productos</h2>
                <p class="panel-subtitle">
                  Productos que no forman parte del almac√©n fijo, pero quieres
                  tener en cuenta.
                </p>
              </div>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="otrosEditModeButton"
              >
                Editar lista
              </button>
            </div>

            <!-- Vista r√°pida -->
            <div id="otrosListPanel" class="sub-panel active">
              <div class="filters filters-edit">
                <div class="form-group quick-add-group">
                  <label>&nbsp;</label>
                  <button
                    type="button"
                    class="btn btn-secondary btn-small btn-quick-add"
                    id="addQuickExtraButton"
                  >
                    +
                  </button>
                </div>
                <div class="form-group search-group">
                  <label for="extraFilterSearch">Buscar en otros</label>
                  <input
                    type="text"
                    id="extraFilterSearch"
                    placeholder="Producto, familia, tipo, notas..."
                  />
                </div>
                <div class="form-group">
                  <label for="extraFilterFamily">Familia</label>
                  <select id="extraFilterFamily">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraFilterType">Tipo</label>
                  <select id="extraFilterType">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraFilterStore">Tienda</label>
                  <select id="extraFilterStore">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraFilterBuy">Comprar</label>
                  <select id="extraFilterBuy">
                    <option value="all">Todos</option>
                    <option value="yes">S√≠</option>
                    <option value="no">No</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <table class="product-table">
                    <thead>
                      <tr>
                        <th>Producto</th>
                        <th>Familia</th>
                        <th>Tipo</th>
                        <th>Cantidad</th>
                        <th class="selection-col">Selecci√≥n</th>
                        <th>Tiendas</th>
                        <th>Comprar</th>
                        <th>Notas</th>
                        <th>Mover a almac√©n</th>
                      </tr>
                    </thead>
                    <tbody id="extraListTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Edici√≥n otros productos -->
            <div id="otrosEditPanel" class="sub-panel">
              <div class="extra-header">
                <div>
                  <h2>Editar otros productos</h2>
                  <p class="panel-subtitle">
                    Gestiona productos que no forman parte del almac√©n
                    principal.
                  </p>
                </div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addExtraRowButton"
                  >
                    A√±adir producto
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveExtraButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>

              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="extraEditFilterSearch">Buscar en otros</label>
                  <input
                    type="text"
                    id="extraEditFilterSearch"
                    placeholder="Producto, notas, selecci√≥n..."
                  />
                </div>
                <div class="form-group">
                  <label for="extraEditFilterFamily">Familia</label>
                  <select id="extraEditFilterFamily">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraEditFilterType">Tipo</label>
                  <select id="extraEditFilterType">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraEditFilterStore">Tienda</label>
                  <select id="extraEditFilterStore">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <table class="product-table">
                    <thead>
                      <tr>
                        <th>Producto</th>
                        <th>Familia</th>
                        <th>Tipo</th>
                        <th>Cantidad</th>
                        <th class="selection-col">Selecci√≥n</th>
                        <th>Tiendas</th>
                        <th>Comprar</th>
                        <th>Notas</th>
                        <th>Mover a almac√©n</th>
                      </tr>
                    </thead>
                    <tbody id="extraTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>

          <!-- ============================
               SECCI√ìN TIENDAS/PRODUCTORES
               ============================ -->
          <section id="proveedoresSection" class="main-section">
            <!-- Productores -->
            <div id="producersPanel" class="sub-panel">
              <div class="subpanel-intro">
                <h3>Productores</h3>
                <p class="panel-subtitle">
                  Gestiona tus productores y sus notas.
                </p>
              </div>
              <div class="extra-header">
                <div></div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addProducerButton"
                  >
                    A√±adir productor
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveProducersButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>
              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="producersSearch">Buscar productor</label>
                  <input
                    type="text"
                    id="producersSearch"
                    placeholder="Nombre, notas..."
                  />
                </div>
                <div class="form-group">
                  <label for="producersLocationFilter">Localizaci√≥n</label>
                  <select id="producersLocationFilter">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <table class="product-table">
                    <thead>
                      <tr>
                        <th>Nombre productor</th>
                        <th>Localizaci√≥n</th>
                        <th>Notas</th>
                        <th>Eliminar</th>
                      </tr>
                    </thead>
                    <tbody id="producersTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Tiendas -->
            <div id="storesPanel" class="sub-panel">
              <div class="subpanel-intro">
                <h3>Tiendas</h3>
                <p class="panel-subtitle">
                  Gestiona las tiendas y su informaci√≥n de contacto.
                </p>
              </div>
              <div class="extra-header">
                <div></div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addStoreButton"
                  >
                    A√±adir tienda
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveStoresButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>
              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="storesSearch">Buscar tienda</label>
                  <input
                    type="text"
                    id="storesSearch"
                    placeholder="Nombre, web, notas..."
                  />
                </div>
                <div class="form-group">
                  <label for="storesTypeFilter">Tipo</label>
                  <select id="storesTypeFilter">
                    <option value="">Todos</option>
                    <option value="fisico">F√≠sico</option>
                    <option value="online">Online</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="storesLocationFilter">Localizaci√≥n</label>
                  <select id="storesLocationFilter">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <table class="product-table">
                    <thead>
                      <tr>
                        <th>Nombre tienda</th>
                        <th>Tipo</th>
                        <th>Localizaci√≥n</th>
                        <th>Web / contacto</th>
                        <th>Notas</th>
                        <th>Eliminar</th>
                      </tr>
                    </thead>
                    <tbody id="storesTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Selecci√≥n de productos (instancias) -->
            <div id="instancesPanel" class="sub-panel active">
              <div class="subpanel-intro">
                <h3>Selecci√≥n de productos</h3>
                <p class="panel-subtitle">
                  Crea combinaciones de producto, productor, marca y tiendas para usarlas como selecci√≥n prioritaria.
                </p>
              </div>
              <div class="extra-header">
                <div></div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addInstanceButton"
                  >
                    A√±adir selecci√≥n
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveInstancesButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>
              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="instancesSearch">Buscar selecci√≥n</label>
                  <input
                    type="text"
                    id="instancesSearch"
                    placeholder="Producto, productor, marca, tienda..."
                  />
                </div>
                <div class="form-group">
                  <label for="instancesFamilyFilter">Familia</label>
                  <select id="instancesFamilyFilter">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="instancesProducerFilter">Productor</label>
                  <select id="instancesProducerFilter">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="instancesStoreFilter">Tienda</label>
                  <select id="instancesStoreFilter">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <!-- datalist para autocompletar productos -->
              <datalist id="productsDatalist"></datalist>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <table class="product-table">
                    <thead>
                      <tr>
                        <th>Producto</th>
                        <th>Familia</th>
                        <th>Productor</th>
                        <th>Marca</th>
                        <th>Tiendas asociadas</th>
                        <th>Notas</th>
                        <th>Eliminar</th>
                      </tr>
                    </thead>
                    <tbody id="instancesTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>
        </section>

        <!-- Panel lista de la compra + backup -->
        <section class="panel panel-shopping">
          <div class="list-header">
            <div>
              <h2>Lista de la compra</h2>
              <p class="panel-subtitle">
                Combina lo que falta del almac√©n y los otros productos,
                agrupado por tienda (Selecci√≥n).
              </p>
            </div>
            <div class="shopping-actions">
              <button
                type="button"
                class="btn btn-primary btn-small"
                id="copyListButton"
              >
                Copiar lista
              </button>
            </div>
          </div>

          <div class="summary" id="shoppingSummary">
            0 producto(s) ¬∑ 0 tienda(s)
          </div>

          <div id="shoppingListContainer"></div>

          <div class="backup-block">
            <h3>Copias de seguridad</h3>
            <div class="backup-actions">
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="exportBackupButton"
              >
                Descargar copia (.json)
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="importBackupButton"
              >
                Restaurar desde archivo
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="exportAlmacenCsvButton"
              >
                Almac√©n a Excel
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="exportOtrosCsvButton"
              >
                Otros productos a Excel
              </button>
              <input
                type="file"
                id="backupFileInput"
                accept="application/json"
                style="display: none"
              />
            </div>
            <p class="backup-note">
              La copia incluye almac√©n, otros productos, productores, tiendas y
              selecci√≥n de productos.
            </p>
          </div>
        </section>
      </main>
    </div>

    <!-- Popup para elegir Selecci√≥n de producto -->
    <div id="selectionPopupOverlay" class="selection-popup-overlay">
      <div id="selectionPopup" class="selection-popup">
        <div class="selection-popup-header">
          <span
            id="selectionPopupTitle"
            class="selection-popup-title"
            >Seleccionar producto</span
          >
          <button
            type="button"
            class="btn btn-secondary btn-small"
            id="selectionPopupClose"
          >
            ‚úï
          </button>
        </div>
        <div class="selection-popup-body">
          <p class="selection-popup-help">
            Elige una Selecci√≥n (productor, marca y tiendas) prioritaria para
            este producto.
          </p>
          <ul id="selectionPopupList"></ul>
        </div>
      </div>
    </div>

    <!-- Librer√≠a para Excel (.xlsx) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="utils.js"></script>
    <script src="storage.js"></script>
    <script src="state.js"></script>
    <script src="dataService.js"></script>
    <script src="classificationView.js"></script>
    <script src="producersView.js"></script>
    <script src="storesView.js"></script>
    <script src="inventoryView.js"></script>
    <script src="app.js"></script>
  </body>
</html>
