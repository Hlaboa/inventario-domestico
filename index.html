<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Gestor de almac√©n de cocina</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap"
    />
    <link rel="icon" href="data:," />
    <link rel="stylesheet" href="styles/styles.css" />
  </head>
  <body>
    <div class="app">


      <main class="app-main shopping-hidden">
        <!-- Panel principal -->
        <section class="panel">
          <!-- Tabs principal -->
          <div class="tabs tabs-main">
            <button
              type="button"
              id="mainAlmacenButton"
              class="tab-button active"
            >
              Almac√©n
            </button>
            <button type="button" id="mainOtrosButton" class="tab-button">
              Otros productos
            </button>
            <button type="button" id="mainSelectionButton" class="tab-button">
              Selecci√≥n de productos
            </button>
            <button type="button" id="mainClassificationButton" class="tab-button">
              Clasificaci√≥n productos
            </button>
            <button type="button" id="mainProducersButton" class="tab-button">
              Productores
            </button>
            <button type="button" id="mainStoresButton" class="tab-button">
              Tiendas
            </button>
            <button
              type="button"
              id="toggleShoppingPanelButton"
              class="tab-button tab-button-icon"
              aria-label="Mostrar u ocultar lista de la compra"
              title="Mostrar u ocultar lista de la compra"
            >
              üõí
            </button>
          </div>

          <!-- ============================
               SECCI√ìN ALMAC√âN
               ============================ -->
          <section id="almacenSection" class="main-section active">
            <div class="section-mode-header">
              <div>
                <h2>Inventario de almac√©n</h2>
                <p class="panel-subtitle">
                  Marca qu√© tienes, qu√© falta y define una Selecci√≥n prioritaria.
                </p>
              </div>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="almacenEditModeButton"
              >
                Editar inventario
              </button>
            </div>

            <!-- Vista principal -->
            <div id="almacenInventoryPanel" class="sub-panel active">
              <template id="inventoryRowTemplate">
                <tr>
                  <td data-field="name"></td>
                  <td data-field="block"></td>
                  <td data-field="type"></td>
                  <td data-field="shelf"></td>
                  <td data-field="quantity"></td>
                  <td class="selection-td">
                    <div class="selection-cell">
                      <button data-role="selection-btn" class="btn btn-small btn-secondary"></button>
                      <div class="selection-text" data-field="selectionText"></div>
                    </div>
                  </td>
                  <td data-field="stores"></td>
                  <td>
                    <input type="checkbox" data-field="have" />
                  </td>
                  <td data-field="acquisitionDate"></td>
                  <td data-field="expiryText"></td>
                  <td data-field="notes"></td>
                  <td>
                    <button class="btn btn-small btn-icon" data-role="move">‚Üí</button>
                  </td>
                </tr>
              </template>
              <div class="filters">
                <div class="form-group quick-add-group">
                  <label>&nbsp;</label>
                  <button
                    type="button"
                    class="btn btn-secondary btn-small btn-quick-add"
                    id="addQuickProductButton"
                  >
                    +
                  </button>
                </div>
                <div class="form-group search-group">
                  <label for="filterSearch">Buscar</label>
                  <input
                    type="text"
                    id="filterSearch"
                    placeholder="Producto, familia, selecci√≥n, notas..."
                  />
                </div>
                <div class="form-group">
                  <label for="filterBlock">Familia</label>
                  <select id="filterBlock">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filterType">Tipo</label>
                  <select id="filterType">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filterShelf">Ubicaci√≥n</label>
                  <select id="filterShelf">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filterStore">Tienda</label>
                  <select id="filterStore">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="filterStatus">Estado</label>
                  <select id="filterStatus">
                    <option value="all">Todos</option>
                    <option value="have">Tengo</option>
                    <option value="missing">Me falta</option>
                  </select>
                </div>
              </div>

              <div class="list-header">
                <div class="summary" id="summaryInfo" aria-live="polite">
                  Total: 0 ¬∑ Tengo: 0 ¬∑ Faltan: 0
                </div>
              </div>

              <div class="table-wrapper" id="instancesTableWrapper">
                <div class="table-scroll">
                  <table class="product-table">
                    <thead>
                      <tr>
                        <th scope="col">Producto</th>
                        <th scope="col">Familia</th>
                        <th scope="col">Tipo</th>
                        <th scope="col">Ubicaci√≥n</th>
                        <th scope="col">Cantidad</th>
                        <th scope="col" class="selection-col">Selecci√≥n</th>
                        <th scope="col">Tiendas</th>
                        <th scope="col">Tengo</th>
                        <th scope="col">F. adquisici√≥n</th>
                        <th scope="col">Caducidad</th>
                        <th scope="col">Notas</th>
                        <th scope="col">Retirar</th>
                      </tr>
                    </thead>
                    <tbody id="productTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Modo edici√≥n -->
            <div id="almacenEditPanel" class="sub-panel">
              <div class="grid-header">
                <div>
                  <h2>Editar inventario</h2>
                  <p class="panel-subtitle">
                    A√±ade, modifica y organiza los productos de tu almac√©n.
                  </p>
                </div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addGridRowButton"
                  >
                    A√±adir producto
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveGridButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>

              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="editFilterSearch">Buscar en edici√≥n</label>
                  <input
                    type="text"
                    id="editFilterSearch"
                    placeholder="Producto, notas, selecci√≥n..."
                  />
                </div>
                <div class="form-group">
                  <label for="editFilterFamily">Familia</label>
                  <select id="editFilterFamily">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="editFilterType">Tipo</label>
                  <select id="editFilterType">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="editFilterShelf">Ubicaci√≥n</label>
                  <select id="editFilterShelf">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="editFilterStore">Tienda</label>
                  <select id="editFilterStore">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <template id="inventoryEditRowTemplate">
                    <tr>
                      <td data-slot="name"></td>
                      <td data-slot="block"></td>
                      <td data-slot="type"></td>
                      <td data-slot="shelf"></td>
                      <td data-slot="quantity"></td>
                      <td class="selection-td">
                        <div class="selection-cell">
                          <span class="selection-text" data-field="selectionText"></span>
                          <button class="btn btn-small btn-icon" data-role="selection-btn">+</button>
                        </div>
                      </td>
                      <td><span data-field="stores"></span></td>
                      <td data-slot="have"></td>
                      <td data-slot="acquisitionDate"></td>
                      <td data-slot="expiryText"></td>
                      <td data-slot="notes"></td>
                      <td>
                        <button class="btn btn-small btn-icon" data-role="move">‚Üí</button>
                        <button class="btn btn-small btn-danger" data-role="delete" aria-label="Eliminar producto">‚úï</button>
                      </td>
                    </tr>
                  </template>
                  <table class="product-table">
                    <colgroup>
                      <col style="width: 18%" />
                      <col style="width: 10%" />
                      <col style="width: 10%" />
                      <col style="width: 8%" />
                      <col style="width: 6%" />
                      <col style="width: 12%" />
                      <col style="width: 8%" />
                      <col style="width: 6%" />
                      <col style="width: 8%" />
                      <col style="width: 7%" />
                      <col style="width: 10%" />
                      <col style="width: 7%" />
                    </colgroup>
                    <thead>
                      <tr>
                        <th scope="col">Producto</th>
                        <th scope="col">Familia</th>
                        <th scope="col">Tipo</th>
                        <th scope="col">Ubicaci√≥n</th>
                        <th scope="col">Cantidad</th>
                        <th scope="col" class="selection-col">Selecci√≥n</th>
                        <th scope="col">Tiendas</th>
                        <th scope="col">Tengo</th>
                        <th scope="col">F. adquisici√≥n</th>
                        <th scope="col">Caducidad</th>
                        <th scope="col">Notas</th>
                        <th scope="col">Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="gridTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>

          <!-- ============================
               SECCI√ìN CLASIFICACI√ìN
               ============================ -->
          <section id="classificationSection" class="main-section">
            <div class="section-mode-header">
              <div>
                <h2>Clasificaci√≥n de productos</h2>
                <p class="panel-subtitle">
                  Gestiona las combinaciones de Familia y Tipo que se usan en todo el inventario.
                </p>
              </div>
              <div class="extra-header-actions">
                <button
                  type="button"
                  class="btn btn-secondary btn-small"
                  id="addClassificationButton"
                >
                  A√±adir combinaci√≥n
                </button>
                <button
                  type="button"
                  class="btn btn-primary btn-small"
                  id="saveClassificationsButton"
                >
                  Guardar cambios
                </button>
              </div>
            </div>

            <div class="table-wrapper">
              <div class="table-scroll">
                <template id="classificationRowTemplate">
                  <tr>
                    <td data-slot="block"></td>
                    <td data-slot="type"></td>
                    <td data-slot="notes"></td>
                    <td>
                      <button class="btn btn-small btn-danger" data-role="delete" aria-label="Eliminar fila">‚úï</button>
                    </td>
                  </tr>
                </template>
                <table class="product-table">
                  <thead>
                    <tr>
                      <th scope="col">Familia</th>
                      <th scope="col">Tipo</th>
                      <th scope="col">Notas</th>
                      <th scope="col">Eliminar</th>
                    </tr>
                  </thead>
                  <tbody id="classificationTableBody"></tbody>
                </table>
              </div>
            </div>
          </section>

          <!-- ============================
               SECCI√ìN OTROS PRODUCTOS
               ============================ -->
          <section id="otrosSection" class="main-section">
            <div class="section-mode-header">
              <div>
                <h2>Otros productos</h2>
                <p class="panel-subtitle">
                  Productos que no forman parte del almac√©n fijo, pero quieres
                  tener en cuenta.
                </p>
              </div>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="otrosEditModeButton"
              >
                Editar lista
              </button>
            </div>

            <!-- Vista r√°pida -->
            <div id="otrosListPanel" class="sub-panel active">
              <template id="extraQuickRowTemplate">
                <tr>
                  <td data-field="name"></td>
                  <td data-field="block"></td>
                  <td data-field="type"></td>
                  <td data-field="quantity"></td>
                  <td class="selection-td">
                    <div class="selection-cell">
                      <button data-role="selection-btn" class="btn btn-small btn-secondary"></button>
                      <div class="selection-text" data-field="selectionText"></div>
                    </div>
                  </td>
                  <td data-field="stores"></td>
                  <td>
                    <input type="checkbox" data-field="buy" />
                  </td>
                  <td data-field="notes"></td>
                  <td>
                    <button
                      type="button"
                      class="btn btn-small btn-icon"
                      data-role="move"
                    >
                      ‚Üí
                    </button>
                  </td>
                </tr>
              </template>

              <div class="filters filters-edit">
                <div class="form-group quick-add-group">
                  <label>&nbsp;</label>
                  <button
                    type="button"
                    class="btn btn-secondary btn-small btn-quick-add"
                    id="addQuickExtraButton"
                  >
                    +
                  </button>
                </div>
                <div class="form-group search-group">
                  <label for="extraFilterSearch">Buscar en otros</label>
                  <input
                    type="text"
                    id="extraFilterSearch"
                    placeholder="Producto, familia, tipo, notas..."
                  />
                </div>
                <div class="form-group">
                  <label for="extraFilterFamily">Familia</label>
                  <select id="extraFilterFamily">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraFilterType">Tipo</label>
                  <select id="extraFilterType">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraFilterStore">Tienda</label>
                  <select id="extraFilterStore">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraFilterBuy">Comprar</label>
                  <select id="extraFilterBuy">
                    <option value="all">Todos</option>
                    <option value="yes">S√≠</option>
                    <option value="no">No</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <template id="extraEditRowTemplate">
                    <tr>
                      <td data-slot="name"></td>
                      <td data-slot="block"></td>
                      <td data-slot="type"></td>
                      <td data-slot="quantity"></td>
                      <td class="selection-td">
                        <div class="selection-cell">
                          <span class="selection-text" data-field="selectionText"></span>
                          <button class="btn btn-small btn-icon" data-role="selection-btn">+</button>
                        </div>
                      </td>
                      <td><span data-field="stores"></span></td>
                      <td data-slot="buy"></td>
                      <td data-slot="notes"></td>
                      <td>
                        <button class="btn btn-small btn-icon" data-role="move">‚Üí</button>
                        <button class="btn btn-small btn-danger" data-role="delete" aria-label="Eliminar">‚úï</button>
                      </td>
                    </tr>
                  </template>
                  <table class="product-table">
                    <colgroup>
                      <col style="width: 20%" />
                      <col style="width: 12%" />
                      <col style="width: 12%" />
                      <col style="width: 8%" />
                      <col style="width: 12%" />
                      <col style="width: 8%" />
                      <col style="width: 6%" />
                      <col style="width: 10%" />
                      <col style="width: 12%" />
                    </colgroup>
                    <thead>
                      <tr>
                        <th scope="col">Producto</th>
                        <th scope="col">Familia</th>
                        <th scope="col">Tipo</th>
                        <th scope="col">Cantidad</th>
                        <th scope="col" class="selection-col">Selecci√≥n</th>
                        <th scope="col">Tiendas</th>
                        <th scope="col">Comprar</th>
                        <th scope="col">Notas</th>
                        <th scope="col">Mover a almac√©n</th>
                      </tr>
                    </thead>
                    <tbody id="extraListTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Edici√≥n otros productos -->
            <div id="otrosEditPanel" class="sub-panel">
              <div class="extra-header">
                <div>
                  <h2>Editar otros productos</h2>
                  <p class="panel-subtitle">
                    Gestiona productos que no forman parte del almac√©n
                    principal.
                  </p>
                </div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addExtraRowButton"
                  >
                    A√±adir producto
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveExtraButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>

              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="extraEditFilterSearch">Buscar en otros</label>
                  <input
                    type="text"
                    id="extraEditFilterSearch"
                    placeholder="Producto, notas, selecci√≥n..."
                  />
                </div>
                <div class="form-group">
                  <label for="extraEditFilterFamily">Familia</label>
                  <select id="extraEditFilterFamily">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraEditFilterType">Tipo</label>
                  <select id="extraEditFilterType">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="extraEditFilterStore">Tienda</label>
                  <select id="extraEditFilterStore">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <table class="product-table">
                    <thead>
                      <tr>
                        <th scope="col">Producto</th>
                        <th scope="col">Familia</th>
                        <th scope="col">Tipo</th>
                        <th scope="col">Cantidad</th>
                        <th scope="col" class="selection-col">Selecci√≥n</th>
                        <th scope="col">Tiendas</th>
                        <th scope="col">Comprar</th>
                        <th scope="col">Notas</th>
                        <th scope="col">Mover a almac√©n</th>
                      </tr>
                    </thead>
                    <tbody id="extraTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>

          <!-- ============================
               SECCI√ìN TIENDAS/PRODUCTORES
               ============================ -->
          <section id="proveedoresSection" class="main-section">
            <!-- Productores -->
            <div id="producersPanel" class="sub-panel">
              <div class="subpanel-intro">
                <h3>Productores</h3>
                <p class="panel-subtitle">
                  Gestiona tus productores y sus notas.
                </p>
              </div>
              <div class="extra-header">
                <div></div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addProducerButton"
                  >
                    A√±adir productor
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveProducersButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>
              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="producersSearch">Buscar productor</label>
                  <input
                    type="text"
                    id="producersSearch"
                    placeholder="Nombre, notas..."
                  />
                </div>
                <div class="form-group">
                  <label for="producersLocationFilter">Localizaci√≥n</label>
                  <select id="producersLocationFilter">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <template id="producersRowTemplate">
                    <tr>
                      <td data-slot="name"></td>
                      <td data-slot="location"></td>
                      <td data-slot="notes"></td>
                      <td>
                        <button class="btn btn-small btn-danger" data-role="delete" aria-label="Eliminar">‚úï</button>
                      </td>
                    </tr>
                  </template>
                  <table class="product-table">
                  <thead>
                    <tr>
                      <th scope="col">Nombre productor</th>
                      <th scope="col">Localizaci√≥n</th>
                      <th scope="col">Notas</th>
                      <th scope="col">Eliminar</th>
                    </tr>
                  </thead>
                    <tbody id="producersTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Tiendas -->
            <div id="storesPanel" class="sub-panel">
              <div class="subpanel-intro">
                <h3>Tiendas</h3>
                <p class="panel-subtitle">
                  Gestiona las tiendas y su informaci√≥n de contacto.
                </p>
              </div>
              <div class="extra-header">
                <div></div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addStoreButton"
                  >
                    A√±adir tienda
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveStoresButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>
              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="storesSearch">Buscar tienda</label>
                  <input
                    type="text"
                    id="storesSearch"
                    placeholder="Nombre, web, notas..."
                  />
                </div>
                <div class="form-group">
                  <label for="storesTypeFilter">Tipo</label>
                  <select id="storesTypeFilter">
                    <option value="">Todos</option>
                    <option value="fisico">F√≠sico</option>
                    <option value="online">Online</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="storesLocationFilter">Localizaci√≥n</label>
                  <select id="storesLocationFilter">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <template id="storesRowTemplate">
                    <tr>
                      <td data-slot="name"></td>
                      <td data-slot="type"></td>
                      <td data-slot="location"></td>
                      <td data-slot="website"></td>
                      <td data-slot="notes"></td>
                      <td>
                        <button class="btn btn-small btn-danger" data-role="delete" aria-label="Eliminar">‚úï</button>
                      </td>
                    </tr>
                  </template>
                  <table class="product-table">
                  <thead>
                    <tr>
                      <th scope="col">Nombre tienda</th>
                      <th scope="col">Tipo</th>
                      <th scope="col">Localizaci√≥n</th>
                      <th scope="col">Web / contacto</th>
                      <th scope="col">Notas</th>
                      <th scope="col">Eliminar</th>
                    </tr>
                  </thead>
                    <tbody id="storesTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Selecci√≥n de productos (instancias) -->
            <div id="instancesPanel" class="sub-panel active">
              <div class="subpanel-intro">
                <h3>Selecci√≥n de productos</h3>
                <p class="panel-subtitle">
                  Crea combinaciones de producto, productor, marca y tiendas para usarlas como selecci√≥n prioritaria.
                </p>
              </div>
              <div class="extra-header">
                <div></div>
                <div class="extra-header-actions">
                  <button
                    type="button"
                    class="btn btn-secondary btn-small"
                    id="addInstanceButton"
                  >
                    A√±adir selecci√≥n
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary btn-small"
                    id="saveInstancesButton"
                  >
                    Guardar cambios
                  </button>
                </div>
              </div>
              <div class="filters filters-edit">
                <div class="form-group search-group">
                  <label for="instancesSearch">Buscar selecci√≥n</label>
                  <input
                    type="text"
                    id="instancesSearch"
                    placeholder="Producto, productor, marca, tienda..."
                  />
                </div>
                <div class="form-group">
                  <label for="instancesFamilyFilter">Familia</label>
                  <select id="instancesFamilyFilter">
                    <option value="">Todas</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="instancesProducerFilter">Productor</label>
                  <select id="instancesProducerFilter">
                    <option value="">Todos</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="instancesStoreFilter">Tienda</label>
                  <select id="instancesStoreFilter">
                    <option value="">Todas</option>
                  </select>
                </div>
              </div>

              <!-- datalist para autocompletar productos -->
              <datalist id="productsDatalist"></datalist>

              <div class="table-wrapper">
                <div class="table-scroll">
                  <template id="instancesRowTemplate">
                    <tr>
                      <td data-slot="productName"></td>
                      <td data-field="family"></td>
                      <td data-slot="producer"></td>
                      <td data-slot="brand"></td>
                      <td data-slot="stores"></td>
                      <td data-slot="notes"></td>
                      <td>
                        <button class="btn btn-small btn-danger" data-role="delete" aria-label="Eliminar">‚úï</button>
                      </td>
                    </tr>
                  </template>
                  <table class="product-table">
                  <thead>
                    <tr>
                      <th scope="col">Producto</th>
                      <th scope="col">Familia</th>
                      <th scope="col">Productor</th>
                      <th scope="col">Marca</th>
                      <th scope="col">Tiendas asociadas</th>
                      <th scope="col">Notas</th>
                      <th scope="col">Eliminar</th>
                    </tr>
                  </thead>
                    <tbody id="instancesTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>
        </section>

        <!-- Panel lista de la compra + backup -->
        <section class="panel panel-shopping">
          <template id="shoppingStoreTemplate">
            <div class="shopping-store-block">
              <div class="shopping-store-header">
                <span class="shopping-store-title"></span>
                <span class="shopping-store-count"></span>
              </div>
              <ul class="shopping-store-items"></ul>
            </div>
          </template>
          <template id="shoppingItemTemplate">
            <li>
              <div class="shopping-item-main"></div>
              <div class="shopping-item-meta"></div>
            </li>
          </template>
          <div class="list-header">
            <div>
              <h2>Lista de la compra</h2>
              <p class="panel-subtitle">
                Combina lo que falta del almac√©n y los otros productos,
                agrupado por tienda (Selecci√≥n).
              </p>
            </div>
            <div class="shopping-actions">
              <button
                type="button"
                class="btn btn-primary btn-small"
                id="copyListButton"
              >
                Copiar lista
              </button>
            </div>
          </div>

          <div class="summary" id="shoppingSummary" aria-live="polite">
            0 producto(s) ¬∑ 0 tienda(s)
          </div>

          <div id="shoppingListContainer"></div>

          <div class="backup-block">
            <h3>Copias de seguridad</h3>
            <div class="backup-actions">
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="exportBackupButton"
              >
                Descargar copia (.json)
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="importBackupButton"
              >
                Restaurar desde archivo
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="exportAlmacenCsvButton"
              >
                Almac√©n a Excel
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-small"
                id="exportOtrosCsvButton"
              >
                Otros productos a Excel
              </button>
              <input
                type="file"
                id="backupFileInput"
                accept="application/json"
                style="display: none"
              />
            </div>
            <p class="backup-note">
              La copia incluye almac√©n, otros productos, productores, tiendas y
              selecci√≥n de productos.
            </p>
          </div>
        </section>
      </main>
    </div>

    <!-- Popup para elegir Selecci√≥n de producto -->
    <div id="selectionPopupOverlay" class="selection-popup-overlay">
      <div id="selectionPopup" class="selection-popup">
        <div class="selection-popup-header">
          <span
            id="selectionPopupTitle"
            class="selection-popup-title"
            >Seleccionar producto</span
          >
          <button
            type="button"
            class="btn btn-secondary btn-small"
            id="selectionPopupClose"
          >
            ‚úï
          </button>
        </div>
        <div class="selection-popup-body">
          <p class="selection-popup-help">
            Elige una Selecci√≥n (productor, marca y tiendas) prioritaria para
            este producto.
          </p>
          <ul id="selectionPopupList"></ul>
        </div>
      </div>
    </div>

    <!-- Librer√≠a para Excel (.xlsx) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="src/core/utils.js"></script>
    <script src="src/core/components.js"></script>
    <script src="src/core/storage.js"></script>
    <script src="src/core/state.js"></script>
    <script src="src/core/dataService.js"></script>
    <script src="src/core/appStore.js"></script>
    <script src="src/core/bootstrap.js"></script>
    <script src="src/core/uiHelpers.js"></script>
    <script src="src/controllers/viewControllers.js"></script>
    <script src="src/controllers/inventoryController.js"></script>
    <script src="src/controllers/extraController.js"></script>
    <script src="src/controllers/instancesController.js"></script>
    <script src="src/controllers/classificationController.js"></script>
    <script src="src/controllers/producersController.js"></script>
    <script src="src/controllers/storesController.js"></script>
    <script src="src/views/classificationView.js"></script>
    <script src="src/views/producersView.js"></script>
    <script src="src/views/storesView.js"></script>
    <script src="src/views/instancesView.js"></script>
    <script src="src/views/inventoryView.js"></script>
    <script src="src/views/inventoryEditView.js"></script>
    <script src="src/views/extrasView.js"></script>
    <script src="src/views/extraEditView.js"></script>
    <script src="src/views/selectionPopup.js"></script>
    <script src="src/app.js"></script>
  </body>
</html>
